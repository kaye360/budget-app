---
import CreateTransactionButton from "../../components/_transactions/CreateTransactionButton.astro";
import FilterTransactions from "../../components/_transactions/FilterTransactions.astro";
import Transaction from "../../components/_transactions/Transaction.astro";
import H1 from "../../components/H1.astro";
import Layout from "../../layouts/Layout.astro";
import { fetchData } from "../../lib/fetch";
import type { DeletedTransactions, GetBudgets } from "../../types/types";

const auth = await Astro.session?.get('auth')

if( !auth ) {
	return Astro.redirect('/')
}

const [transactions, budgets] = await Promise.all([
	fetchData<DeletedTransactions>(`/api/transactions/uncategorized`),
	fetchData<GetBudgets>('/api/budgets'),
])

---

<Layout>
	
	<FilterTransactions current="uncategorized" />

	<div class="mb-2 flex items-center justify-between">
		<H1>
			Uncategorized Transactions
		</H1>

		<CreateTransactionButton />
	</div>

	<transaction-list class="grid">
		{ transactions.response?.data && transactions.response.data.map( transaction => (
			<Transaction {transaction} budgets={budgets.response?.data} />
		))}
	</transaction-list>

</Layout>


---
import { actions } from "astro:actions";
import TransactionListLayout from "../../../layouts/TransactionListLayout.astro";
import CreateTransaction from "../components/CreateTransaction";

const [transactionsResponse, budgetsResponse, accountsResponse] = await Promise.all([
    Astro.callAction( actions.transaction.byRecent, { perPage : 25 } ),
    Astro.callAction( actions.budget.index, {} ),
    Astro.callAction( actions.accounts.index, {} )
]) 

const transactions = transactionsResponse.error ? [] : transactionsResponse.data.list
const budgets = budgetsResponse.error ? [] : budgetsResponse.data
const accounts = accountsResponse.error ? [] : accountsResponse.data

console.log(transactions)
---

<TransactionListLayout
    title="Add a Transaction"
>
    <form>

        <div class="grid gap-4">
            <CreateTransaction 
                transactions={transactions}
                budgets={budgets} 
                accounts={accounts} 
                client:only="react"
            />
        </div>

        <div class="sm:col-span-2 grid grid-cols-2 gap-4">

            <view-transactions-link class="self-center opacity-0 -translate-x-4 pl-2 transition-all">
                <a href="/transactions/recent">
                    View Transactions &rarr;
                </a>
            </view-transactions-link>
        </div>
    </form>

</TransactionListLayout>

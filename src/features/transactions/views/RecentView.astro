---
import { actions } from "astro:actions"
import H1 from "../../../components/H1.astro"
import CreateTransactionButton from "../components/CreateTransactionButton.astro"
import FilterTransactions from "../components/FilterTransactions.astro"
import ImportTransactionButton from "../components/ImportTransactionButton.astro"
import MoreTransactionsButton from "../components/MoreTransactionsButton.astro"
import Transaction from "../components/Transaction.astro"
import AppLayout from "../../../layouts/AppLayout.astro"
import type { Transaction as TransactionType } from "../../../types/types"
import TransactionList from "../components/TransactionList.astro"

const [transactions, budgets] = await Promise.all([
	Astro.callAction( actions.transaction.index, {filter : 'recent'} ),
	Astro.callAction( actions.budget.index, {} )
])
---

<AppLayout>
	
	<FilterTransactions current="recent" />

	<div class="mb-4 flex items-center justify-between flex-wrap gap-y-2">
		<H1>
			Recent Transactions
		</H1>

		<span class="flex items-center gap-4">
			<CreateTransactionButton />
			<ImportTransactionButton />
		</span>
	</div>

	<TransactionList>
		{ !transactions.error && transactions.data.list.map( (transaction: TransactionType ) => (
			<Transaction {transaction} budgets={budgets.data} />
		))}
		<template id="transaction-template">
			<Transaction budgets={budgets.data}/>
		</template>
	</transaction-list>

	<MoreTransactionsButton />

</Layout>


---
interface Props {
	data : {
		label : string,
		amount : number
	}[]
}

const {	data } = Astro.props

const size = 220
const strokeWidth = 15
const radius = (size - strokeWidth) / 2;
const circumference = 2 * Math.PI * radius;
const center = size / 2;

const total = data.reduce((sum, s) => sum + s.amount, 0);

let dashOffset = 0;
let angleCursor = 0;
const gap = strokeWidth * 1.6;
---

<svg
	width={size}
	height={size}
	viewBox={`0 0 ${size} ${size}`}
	role="img"
	aria-label="Pie chart"
	class="overflow-visible mx-auto pointer-events-none w-fit max-w-48.75 sm:max-w-none"
>
	<!-- Rotate so chart starts at 12 oâ€™clock -->
	<g transform={`rotate(-90 ${center} ${center})`}>
		{
			data.map((slice, i) => {

				const fraction = slice.amount / total

				const rawDash = fraction * circumference
				const adjustedDash = Math.max(rawDash - gap, 0)

				const dashArray = `${adjustedDash} ${circumference - adjustedDash}`

				const currentOffset = dashOffset
				dashOffset -= rawDash

				return (
					<circle
						cx={center}
						cy={center}
						r={radius}
						fill="transparent"
						stroke-width={strokeWidth}
						stroke-dasharray={dashArray}
						stroke-dashoffset={currentOffset}
						stroke-linecap="round"
						class:list={[
							i === 0 && 'stroke-red/50',
							i === 1 && 'stroke-green/50',
							i === 2 && 'stroke-blue/50',
							i === 3 && 'stroke-slate-400/50',
							i === 4 && 'stroke-orange/50',
							i === 5 && 'stroke-purple/50',
							i === 6 && 'stroke-yellow-400/50',
							i === 7 && 'stroke-neutral-500/50',
						]}
					/>
				);
			})
		}
	</g>

</svg>

<style>
	circle {
		animation: draw 30ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
		transform-origin: center;
	}

	circle, text {
		animation: draw 750ms cubic-bezier(0.16, 1, 0.3, 1) forwards;
		transform-origin: bottom;
	}

	@keyframes draw {
		from {
			transform: scale(0);
		}
		to {
			transform: scale(1);
		}
	}
</style>
